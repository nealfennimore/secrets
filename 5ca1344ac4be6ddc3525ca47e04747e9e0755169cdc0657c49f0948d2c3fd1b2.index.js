var z=(e,r={})=>fetch(new Request(`https://secrets.api.neal.codes/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})),L;(t=>{async function e(n){let o=await z("retrieve",n);if(o.ok){let{iv:c,ciphertext:i}=await o.json();return{iv:Uint8Array.from(c).buffer,ciphertext:Uint8Array.from(i).buffer}}let a=await o.json();throw new Error(a?.message)}t.retrieve=e;async function r({ciphertext:n,iv:o}){let a={iv:Array.from(new Uint8Array(o)),ciphertext:Array.from(new Uint8Array(n))},c=await z("store",a);if(c.ok)return await c.json();let i=await c.json();throw new Error(i?.message)}t.store=r})(L||={});var G=class{static async load(){return typeof crypto<"u"?Promise.resolve(crypto):await(await import("node:crypto")).webcrypto}},d=G.load();async function ee(e,r,t){return await(await d).subtle.encrypt(e,r,t)}async function re(e,r,t){return await(await d).subtle.decrypt(e,r,t)}async function T(e,r,t){return await(await d).subtle.sign(e,r,t)}async function R(e,r,t,n){return await(await d).subtle.verify(e,r,t,n)}async function te(e,r,t,n,o){return await(await d).subtle.deriveKey(e,r,t,n,o)}async function ne(e,r,t){if(t%8!==0)throw new RangeError("Length must be a multiple of 8");return await(await d).subtle.deriveBits(e,r,t)}async function oe(e,r,t,n){return await(await d).subtle.wrapKey(e,r,t,n)}async function ae(e,r,t,n,o,a,c){return await(await d).subtle.unwrapKey(e,r,t,n,o,a,c)}async function S(e,r){return e==="jwk"?await(await d).subtle.exportKey(e,r):await(await d).subtle.exportKey(e,r)}async function A(e,r,t,n,o){return e==="jwk"?await(await d).subtle.importKey(e,r,t,n,o):await(await d).subtle.importKey(e,r,t,n,o)}async function h(e,r,t){return await(await d).subtle.generateKey(e,r,t)}async function ie(e,r){return await(await d).subtle.digest(e,r)}var P;(function(e){let r;(function(n){n.ECDSA="ECDSA",n.ECDH="ECDH"})(r=e.Variant||(e.Variant={}));let t;(function(n){n.P_256="P-256",n.P_384="P-384",n.P_521="P-521"})(t=e.Curve||(e.Curve={}))})(P||(P={}));var se;(function(e){async function r(o,a=!0,c){return await h(o,a,c??x(o.name))}e.generateKey=r;async function t(o,a,c,i=!0,s){return await A(o,a,c,i,s??x(c.name))}e.importKey=t;async function n(o,a){return await S(o,a)}e.exportKey=n})(se||(se={}));function w(e){return function(t){return new Proxy(t,e)}}var E;(function(e){let r;(function(t){t.SHA_1="SHA-1",t.SHA_256="SHA-256",t.SHA_384="SHA-384",t.SHA_512="SHA-512"})(r=e.Variant||(e.Variant={}))})(E||(E={}));var I;(function(e){e.hexify=r=>Array.from(new Uint8Array(r)).map(t=>t.toString(16).padStart(2,"0")).join("")})(I||(I={}));var ce={get(e,r){switch(r){case"self":return e;case"sign":return t=>Re(e,t);case"verify":return(t,n)=>De(e,t,n);case"exportKey":return t=>Te(t,e)}return Reflect.get(e,r)}},b;(function(e){let r;(function(t){t.HMAC="HMAC"})(r=e.Code||(e.Code={}))})(b||(b={}));async function Te(e,r){return await S(e,r)}async function Re(e,r){return await T({name:b.Code.HMAC},e,r)}async function De(e,r,t){return await R({name:b.Code.HMAC},e,r,t)}var v;(function(e){let r;(function(t){t.PBKDF2="PBKDF2",t.HKDF="HKDF"})(r=e.Variant||(e.Variant={}))})(v||(v={}));var B;(function(e){async function r(o,a,c,i=!1){return await A(o,a,c,i,F)}e.generateKeyMaterial=r;async function t(o,a,c,i=!0,s){return await te(o,a,c,i,s??x(c.name))}e.deriveKey=t;async function n(o,a,c){return await ne(o,a,c)}e.deriveBits=n})(B||(B={}));var H;(function(e){let r;(function(t){t.RSA_OAEP="RSA-OAEP",t.RSA_PSS="RSA-PSS",t.RSASSA_PKCS1_v1_5="RSASSA-PKCS1-v1_5"})(r=e.Variant||(e.Variant={}))})(H||(H={}));var ye;(function(e){async function r(c,i=!0,s){return await h(c,i,s??x(c.name))}e.generateKey=r;async function t(c,i,s,p=!0,u){return await A(c,i,s,p,u??x(s.name))}e.importKey=t;async function n(c,i){return await S(c,i)}e.exportKey=n;async function o(c,i,s){return await T(c,i,s)}e.sign=o;async function a(c,i,s,p){return await R(c,i,s,p)}e.verify=a})(ye||(ye={}));var pe;(function(e){e.raw="raw",e.pkcs8="pkcs8",e.spki="spki",e.jwk="jwk"})(pe||(pe={}));var K;(function(e){e.encrypt="encrypt",e.decrypt="decrypt",e.sign="sign",e.verify="verify",e.deriveKey="deriveKey",e.deriveBits="deriveBits",e.wrapKey="wrapKey",e.unwrapKey="unwrapKey"})(K||(K={}));var Ue=[K.encrypt,K.decrypt],Ve=[K.sign,K.verify],ke=[K.wrapKey,K.unwrapKey],F=[K.deriveKey,K.deriveBits];function x(e){switch(e){case y.Mode.AES_CBC:case y.Mode.AES_CTR:case y.Mode.AES_GCM:case H.Variant.RSA_OAEP:return Ue;case b.Code.HMAC:case P.Variant.ECDSA:case H.Variant.RSA_PSS:case H.Variant.RSASSA_PKCS1_v1_5:return Ve;case P.Variant.ECDH:case v.Variant.HKDF:case v.Variant.PBKDF2:return F;case y.Mode.AES_KW:return ke;default:throw new Error(`Invalid alg ${e}`)}}var y;(function(e){let r;(function(t){t.AES_CBC="AES-CBC",t.AES_CTR="AES-CTR",t.AES_GCM="AES-GCM",t.AES_KW="AES-KW"})(r=e.Mode||(e.Mode={}))})(y||(y={}));var f;(function(e){async function r(s,p=!0,u){return await h(s,p,u??x(s.name))}e.generateKey=r;async function t(s,p,u,C=!0,q){return await A(s,p,u,C,q??x(u.name))}e.importKey=t;async function n(s,p){return await S(s,p)}e.exportKey=n;async function o(s,p,u){return await ee(s,p,u)}e.encrypt=o;async function a(s,p,u){return await re(s,p,u)}e.decrypt=a;async function c(s,p,u,C){return await oe(s,p,u,C)}e.wrapKey=c;async function i(s,p,u,C,q,We=!0,Le){return await ae(s,p,C,q,u,We,Le??x(u.name))}e.unwrapKey=i})(f||(f={}));var ue={get(e,r){switch(r){case"self":return e;case"encrypt":return(t,n)=>Ie(t,e,n);case"decrypt":return(t,n)=>Fe(t,e,n);case"wrapKey":return(t,n,o)=>Ne(t,n,e,o);case"unwrapKey":return(t,n,o,a,c,i)=>je(t,n,o,e,a,c,i);case"exportKey":return t=>Ge(t,e)}return Reflect.get(e,r)}};var Ge=async(e,r)=>f.exportKey(e,r);async function Ie(e,r,t){return await f.encrypt({...e,name:y.Mode.AES_CBC},r,t)}async function Fe(e,r,t){return await f.decrypt({...e,name:y.Mode.AES_CBC},r,t)}async function Ne(e,r,t,n){return await f.wrapKey(e,r,t,{...n,name:y.Mode.AES_CBC})}async function je(e,r,t,n,o,a=!0,c){return await f.unwrapKey(e,r,t,n,{...o,name:y.Mode.AES_CBC},a,c)}async function _(e){return await(await d).getRandomValues(new Uint8Array(e))}var D;(function(e){async function r(t=16){return await _(t)}e.generate=r})(D||(D={}));var U;(function(e){async function r(t=16){return await _(t)}e.generate=r})(U||(U={}));var fe;(function(e){async function r(){return await(await d).randomUUID()}e.generate=r})(fe||(fe={}));var de={get(e,r){switch(r){case"self":return e;case"encrypt":return(t,n)=>$e(t,e,n);case"decrypt":return(t,n)=>Je(t,e,n);case"wrapKey":return(t,n,o)=>Qe(t,n,e,o);case"unwrapKey":return(t,n,o,a,c,i)=>Xe(t,n,o,e,a,c,i);case"exportKey":return t=>Oe(t,e)}return Reflect.get(e,r)}};var Oe=async(e,r)=>f.exportKey(e,r);async function $e(e,r,t){return await f.encrypt({...e,name:y.Mode.AES_CTR},r,t)}async function Je(e,r,t){return await f.decrypt({...e,name:y.Mode.AES_CTR},r,t)}async function Qe(e,r,t,n){return await f.wrapKey(e,r,t,{...n,name:y.Mode.AES_CTR})}async function Xe(e,r,t,n,o,a=!0,c){return await f.unwrapKey(e,r,t,n,{...o,name:y.Mode.AES_CTR},a,c)}var me={get(e,r){switch(r){case"self":return e;case"encrypt":return(t,n)=>Ze(t,e,n);case"decrypt":return(t,n)=>ze(t,e,n);case"wrapKey":return(t,n,o)=>er(t,n,e,o);case"unwrapKey":return(t,n,o,a,c,i)=>rr(t,n,o,e,a,c,i);case"exportKey":return t=>Ye(t,e)}return Reflect.get(e,r)}};var Ye=async(e,r)=>f.exportKey(e,r);async function Ze(e,r,t){return await f.encrypt({...e,name:y.Mode.AES_GCM},r,t)}async function ze(e,r,t){return await f.decrypt({...e,name:y.Mode.AES_GCM},r,t)}async function er(e,r,t,n){return await f.wrapKey(e,r,t,{...n,name:y.Mode.AES_GCM})}async function rr(e,r,t,n,o,a=!0,c){return await f.unwrapKey(e,r,t,n,{...o,name:y.Mode.AES_GCM},a,c)}var le={get(e,r){switch(r){case"self":return e;case"wrapKey":return(t,n)=>nr(t,n,e);case"unwrapKey":return(t,n,o,a,c)=>or(t,n,o,e,a,c);case"exportKey":return t=>tr(t,e)}return Reflect.get(e,r)}};var tr=async(e,r)=>f.exportKey(e,r);async function nr(e,r,t){return await f.wrapKey(e,r,t,{name:y.Mode.AES_KW})}async function or(e,r,t,n,o=!0,a){return await f.unwrapKey(e,r,t,n,{name:y.Mode.AES_KW},o,a)}var ar={get(e,r){switch(r){case"self":return e;case"deriveKey":return(t,n,o,a)=>ir(t,e,n,o,a);case"deriveBits":return(t,n)=>sr(t,e,n)}return Reflect.get(e,r)}},xe={"SHA-1":13e5,"SHA-256":6e5,"SHA-384":6e5,"SHA-512":21e4},we=async(e,r,t)=>{let n=await B.generateKeyMaterial(e,r,v.Variant.PBKDF2,t);return w(ar)(n)},ir=async(e,r,t,n,o)=>{let a=await B.deriveKey({...e,name:v.Variant.PBKDF2,iterations:xe[e.hash]},r,t,n,o);switch(t.name){case b.Code.HMAC:return w(ce)(a);case y.Mode.AES_CBC:return w(ue)(a);case y.Mode.AES_CTR:return w(de)(a);case y.Mode.AES_GCM:return w(me)(a);case y.Mode.AES_KW:return w(le)(a)}throw new Error("Invalid alg")},sr=(e,r,t)=>B.deriveBits({...e,name:v.Variant.PBKDF2,iterations:xe[e.hash]},r,t);var Ke=async e=>ie(E.Variant.SHA_256,e);var Ae={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6};var V={parse:function(r,t){return yr(r,Ae,t)},stringify:function(r,t){return pr(r,Ae,t)}};function yr(e,r,t){var n;if(t===void 0&&(t={}),!r.codes){r.codes={};for(var o=0;o<r.chars.length;++o)r.codes[r.chars[o]]=o}if(!t.loose&&e.length*r.bits&7)throw new SyntaxError("Invalid padding");for(var a=e.length;e[a-1]==="=";)if(--a,!t.loose&&!((e.length-a)*r.bits&7))throw new SyntaxError("Invalid padding");for(var c=new((n=t.out)!=null?n:Uint8Array)(a*r.bits/8|0),i=0,s=0,p=0,u=0;u<a;++u){var C=r.codes[e[u]];if(C===void 0)throw new SyntaxError("Invalid character "+e[u]);s=s<<r.bits|C,i+=r.bits,i>=8&&(i-=8,c[p++]=255&s>>i)}if(i>=r.bits||255&s<<8-i)throw new SyntaxError("Unexpected end of data");return c}function pr(e,r,t){t===void 0&&(t={});for(var n=t,o=n.pad,a=o===void 0?!0:o,c=(1<<r.bits)-1,i="",s=0,p=0,u=0;u<e.length;++u)for(p=p<<8|255&e[u],s+=8;s>r.bits;)s-=r.bits,i+=r.chars[c&p>>s];if(s&&(i+=r.chars[c&p<<r.bits-s]),a)for(;i.length*r.bits&7;)i+="=";return i}function N(e){return new TextDecoder().decode(V.parse(e,{loose:!0}))}function j(e){return V.stringify(new TextEncoder().encode(e),{pad:!1})}function Se(...e){let r=e.reduce((o,a)=>o+a.byteLength,0),t=new Uint8Array(r),n=0;for(let o of e)t.set(new Uint8Array(o),n),n+=o.byteLength;return t.buffer}var O=j,$=N,ve=new TextEncoder,Ce=new TextDecoder,k=ve.encode.bind(ve),be=Ce.decode.bind(Ce),ur=e=>Uint8Array.from(e,r=>r.charCodeAt(0)).buffer,fr=e=>String.fromCharCode(...new Uint8Array(e)),J=e=>ur($(e)),Q=e=>O(fr(e));async function X(e){return await Ke(e)}async function he({key:e,plaintext:r}){let t=await D.generate(16),n=await e.encrypt({iv:t},r);return{iv:t,ciphertext:n}}async function ge({key:e,iv:r,ciphertext:t}){return await e.decrypt({iv:r},t)}async function Ee(e){let r=await U.generate(16),t=await _(16),n=await Y({salt:r,entropy:t,password:e});return{salt:r,entropy:t,key:n}}async function Y({salt:e,entropy:r,password:t}){return await(await we("raw",Se(r,t))).deriveKey({hash:E.Variant.SHA_256,salt:e},{name:y.Mode.AES_GCM,length:256})}var Me=document.querySelector("section#loader"),W=document.querySelector("aside#error"),m;(s=>(s.section=document.querySelector("section#encrypt"),s.form=s.section.querySelector("form#encrypt-form"),s.formBtn=s.form.querySelector("button"),s.password=s.form.querySelector("input#encrypt-password"),s.secret=s.form.querySelector("textarea#encrypt-secret"),s.aside=s.section.querySelector("aside#encrypt-aside"),s.url=s.aside.querySelector("input#encrypt-url"),s.copy=s.aside.querySelector("button#encrypt-url-btn")))(m||={});var l;(i=>(i.section=document.querySelector("section#decrypt"),i.form=i.section.querySelector("form#decrypt-form"),i.formBtn=i.form.querySelector("button"),i.password=i.section.querySelector("input#decrypt-password"),i.aside=i.section.querySelector("aside#decrypt-aside"),i.secret=i.aside.querySelector("textarea#decrypt-secret"),i.copy=i.aside.querySelector("button#decrypt-secret-btn")))(l||={});function Be({salt:e,entropy:r,id:t}){let n=JSON.stringify({salt:Q(e),entropy:Q(r),id:t});return O(n)}function He(){let{salt:e,entropy:r,id:t}=JSON.parse($(window.location.hash.slice(1)));return{salt:J(e),entropy:J(r),id:t}}async function wr(e){if(Z(),e.preventDefault(),l.form.reportValidity()&&window.location.hash)try{l.formBtn.setAttribute("disabled","disabled");let{id:r,salt:t,entropy:n}=He(),{iv:o,ciphertext:a}=await L.retrieve({id:r}),c=await X(k(l.password.value.trim())),i=await Y({salt:t,entropy:n,password:c}),s=await ge({key:i,iv:o,ciphertext:a});l.secret.value=be(s),l.form.classList.add("hidden"),l.aside.classList.remove("hidden"),history.replaceState("",document.title,window.location.pathname+window.location.search)}catch(r){_e(r)}finally{l.formBtn.removeAttribute("disabled")}return!1}async function Kr(e){if(Z(),e.preventDefault(),m.form.reportValidity())try{m.formBtn.setAttribute("disabled","disabled");let r=await X(k(m.password.value.trim())),{key:t,salt:n,entropy:o}=await Ee(r),a=k(m.secret.value),c=await he({key:t,plaintext:a}),{id:i}=await L.store(c),s=Be({salt:n,entropy:o,id:i});m.url.value=`${location.origin}#${s}`,m.form.classList.add("hidden"),m.aside.classList.remove("hidden")}catch(r){_e(r)}finally{m.formBtn.removeAttribute("disabled")}return!1}var Pe=e=>function(t){if(t.target){let n=e.parentNode?.querySelector(".default-message"),o=e.parentNode?.querySelector(".success-message");navigator.clipboard.writeText(e.value).then(()=>{n?.classList.add("hidden"),o?.classList.remove("hidden"),setTimeout(()=>{n?.classList.remove("hidden"),o?.classList.add("hidden")},2e3)})}};function _e(e){let r=W.querySelector("#error-text");r&&(r.textContent=e?.message),W.classList.remove("hidden")}function Z(){W.classList.add("hidden")}function Ar(){m.form.reset(),l.form.reset(),m.form.addEventListener("submit",Kr),l.form.addEventListener("submit",wr),m.url.value="",l.secret.value="",window.location.hash?l.section.classList.remove("hidden"):m.section.classList.remove("hidden"),m.copy.addEventListener("click",Pe(m.url)),l.copy.addEventListener("click",Pe(l.secret)),Me.classList.add("hidden"),W.querySelector("button")?.addEventListener("click",Z)}Ar();
//# sourceMappingURL=index.js.map
