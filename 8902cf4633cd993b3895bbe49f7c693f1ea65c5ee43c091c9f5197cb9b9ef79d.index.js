var ee=(e,t={})=>fetch(new Request(`https://secrets.api.neal.codes/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),T;(r=>{async function e(n){let a=await ee("retrieve",n);if(a.ok){let{iv:c,ciphertext:s}=await a.json();return{iv:Uint8Array.from(c).buffer,ciphertext:Uint8Array.from(s).buffer}}let o=await a.json();throw new Error(o?.message)}r.retrieve=e;async function t({ciphertext:n,iv:a}){let o={iv:Array.from(new Uint8Array(a)),ciphertext:Array.from(new Uint8Array(n))},c=await ee("store",o);if(c.ok)return await c.json();let s=await c.json();throw new Error(s?.message)}r.store=t})(T||={});var G=class{static async load(){return typeof crypto<"u"?Promise.resolve(crypto):await(await import("node:crypto")).webcrypto}},d=G.load();async function re(e,t,r){return await(await d).subtle.encrypt(e,t,r)}async function te(e,t,r){return await(await d).subtle.decrypt(e,t,r)}async function W(e,t,r){return await(await d).subtle.sign(e,t,r)}async function L(e,t,r,n){return await(await d).subtle.verify(e,t,r,n)}async function ne(e,t,r,n,a){return await(await d).subtle.deriveKey(e,t,r,n,a)}async function ae(e,t,r){if(r%8!==0)throw new RangeError("Length must be a multiple of 8");return await(await d).subtle.deriveBits(e,t,r)}async function oe(e,t,r,n){return await(await d).subtle.wrapKey(e,t,r,n)}async function se(e,t,r,n,a,o,c){return await(await d).subtle.unwrapKey(e,t,r,n,a,o,c)}async function b(e,t){return e==="jwk"?await(await d).subtle.exportKey(e,t):await(await d).subtle.exportKey(e,t)}async function A(e,t,r,n,a){return e==="jwk"?await(await d).subtle.importKey(e,t,r,n,a):await(await d).subtle.importKey(e,t,r,n,a)}async function S(e,t,r){return await(await d).subtle.generateKey(e,t,r)}async function ie(e,t){return await(await d).subtle.digest(e,t)}var H;(function(e){let t;(function(n){n.ECDSA="ECDSA",n.ECDH="ECDH"})(t=e.Variant||(e.Variant={}));let r;(function(n){n.P_256="P-256",n.P_384="P-384",n.P_521="P-521"})(r=e.Curve||(e.Curve={}))})(H||(H={}));var ce;(function(e){async function t(a,o=!0,c){return await S(a,o,c??x(a.name))}e.generateKey=t;async function r(a,o,c,s=!0,i){return await A(a,o,c,s,i??x(c.name))}e.importKey=r;async function n(a,o){return await b(a,o)}e.exportKey=n})(ce||(ce={}));function w(e){return function(r){return new Proxy(r,e)}}var E;(function(e){let t;(function(r){r.SHA_1="SHA-1",r.SHA_256="SHA-256",r.SHA_384="SHA-384",r.SHA_512="SHA-512"})(t=e.Variant||(e.Variant={}))})(E||(E={}));var F;(function(e){e.hexify=t=>Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("")})(F||(F={}));var ye={get(e,t){switch(t){case"self":return e;case"sign":return r=>Ue(e,r);case"verify":return(r,n)=>De(e,r,n);case"exportKey":return r=>Le(r,e)}return Reflect.get(e,t)}},C;(function(e){let t;(function(r){r.HMAC="HMAC"})(t=e.Code||(e.Code={}))})(C||(C={}));async function Le(e,t){return await b(e,t)}async function Ue(e,t){return await W({name:C.Code.HMAC},e,t)}async function De(e,t,r){return await L({name:C.Code.HMAC},e,t,r)}var v;(function(e){let t;(function(r){r.PBKDF2="PBKDF2",r.HKDF="HKDF"})(t=e.Variant||(e.Variant={}))})(v||(v={}));var B;(function(e){async function t(a,o,c,s=!1){return await A(a,o,c,s,N)}e.generateKeyMaterial=t;async function r(a,o,c,s=!0,i){return await ne(a,o,c,s,i??x(c.name))}e.deriveKey=r;async function n(a,o,c){return await ae(a,o,c)}e.deriveBits=n})(B||(B={}));var P;(function(e){let t;(function(r){r.RSA_OAEP="RSA-OAEP",r.RSA_PSS="RSA-PSS",r.RSASSA_PKCS1_v1_5="RSASSA-PKCS1-v1_5"})(t=e.Variant||(e.Variant={}))})(P||(P={}));var pe;(function(e){async function t(c,s=!0,i){return await S(c,s,i??x(c.name))}e.generateKey=t;async function r(c,s,i,p=!0,u){return await A(c,s,i,p,u??x(i.name))}e.importKey=r;async function n(c,s){return await b(c,s)}e.exportKey=n;async function a(c,s,i){return await W(c,s,i)}e.sign=a;async function o(c,s,i,p){return await L(c,s,i,p)}e.verify=o})(pe||(pe={}));var ue;(function(e){e.raw="raw",e.pkcs8="pkcs8",e.spki="spki",e.jwk="jwk"})(ue||(ue={}));var K;(function(e){e.encrypt="encrypt",e.decrypt="decrypt",e.sign="sign",e.verify="verify",e.deriveKey="deriveKey",e.deriveBits="deriveBits",e.wrapKey="wrapKey",e.unwrapKey="unwrapKey"})(K||(K={}));var Ve=[K.encrypt,K.decrypt],ke=[K.sign,K.verify],qe=[K.wrapKey,K.unwrapKey],N=[K.deriveKey,K.deriveBits];function x(e){switch(e){case y.Mode.AES_CBC:case y.Mode.AES_CTR:case y.Mode.AES_GCM:case P.Variant.RSA_OAEP:return Ve;case C.Code.HMAC:case H.Variant.ECDSA:case P.Variant.RSA_PSS:case P.Variant.RSASSA_PKCS1_v1_5:return ke;case H.Variant.ECDH:case v.Variant.HKDF:case v.Variant.PBKDF2:return N;case y.Mode.AES_KW:return qe;default:throw new Error(`Invalid alg ${e}`)}}var y;(function(e){let t;(function(r){r.AES_CBC="AES-CBC",r.AES_CTR="AES-CTR",r.AES_GCM="AES-GCM",r.AES_KW="AES-KW"})(t=e.Mode||(e.Mode={}))})(y||(y={}));var f;(function(e){async function t(i,p=!0,u){return await S(i,p,u??x(i.name))}e.generateKey=t;async function r(i,p,u,h=!0,I){return await A(i,p,u,h,I??x(u.name))}e.importKey=r;async function n(i,p){return await b(i,p)}e.exportKey=n;async function a(i,p,u){return await re(i,p,u)}e.encrypt=a;async function o(i,p,u){return await te(i,p,u)}e.decrypt=o;async function c(i,p,u,h){return await oe(i,p,u,h)}e.wrapKey=c;async function s(i,p,u,h,I,Te=!0,We){return await se(i,p,h,I,u,Te,We??x(u.name))}e.unwrapKey=s})(f||(f={}));var fe={get(e,t){switch(t){case"self":return e;case"encrypt":return(r,n)=>Fe(r,e,n);case"decrypt":return(r,n)=>Ne(r,e,n);case"wrapKey":return(r,n,a)=>je(r,n,e,a);case"unwrapKey":return(r,n,a,o,c,s)=>Oe(r,n,a,e,o,c,s);case"exportKey":return r=>Ge(r,e)}return Reflect.get(e,t)}};var Ge=async(e,t)=>f.exportKey(e,t);async function Fe(e,t,r){return await f.encrypt({...e,name:y.Mode.AES_CBC},t,r)}async function Ne(e,t,r){return await f.decrypt({...e,name:y.Mode.AES_CBC},t,r)}async function je(e,t,r,n){return await f.wrapKey(e,t,r,{...n,name:y.Mode.AES_CBC})}async function Oe(e,t,r,n,a,o=!0,c){return await f.unwrapKey(e,t,r,n,{...a,name:y.Mode.AES_CBC},o,c)}async function _(e){return await(await d).getRandomValues(new Uint8Array(e))}var U;(function(e){async function t(r=16){return await _(r)}e.generate=t})(U||(U={}));var D;(function(e){async function t(r=16){return await _(r)}e.generate=t})(D||(D={}));var de;(function(e){async function t(){return await(await d).randomUUID()}e.generate=t})(de||(de={}));var me={get(e,t){switch(t){case"self":return e;case"encrypt":return(r,n)=>Je(r,e,n);case"decrypt":return(r,n)=>Qe(r,e,n);case"wrapKey":return(r,n,a)=>Xe(r,n,e,a);case"unwrapKey":return(r,n,a,o,c,s)=>Ye(r,n,a,e,o,c,s);case"exportKey":return r=>$e(r,e)}return Reflect.get(e,t)}};var $e=async(e,t)=>f.exportKey(e,t);async function Je(e,t,r){return await f.encrypt({...e,name:y.Mode.AES_CTR},t,r)}async function Qe(e,t,r){return await f.decrypt({...e,name:y.Mode.AES_CTR},t,r)}async function Xe(e,t,r,n){return await f.wrapKey(e,t,r,{...n,name:y.Mode.AES_CTR})}async function Ye(e,t,r,n,a,o=!0,c){return await f.unwrapKey(e,t,r,n,{...a,name:y.Mode.AES_CTR},o,c)}var le={get(e,t){switch(t){case"self":return e;case"encrypt":return(r,n)=>ze(r,e,n);case"decrypt":return(r,n)=>er(r,e,n);case"wrapKey":return(r,n,a)=>rr(r,n,e,a);case"unwrapKey":return(r,n,a,o,c,s)=>tr(r,n,a,e,o,c,s);case"exportKey":return r=>Ze(r,e)}return Reflect.get(e,t)}};var Ze=async(e,t)=>f.exportKey(e,t);async function ze(e,t,r){return await f.encrypt({...e,name:y.Mode.AES_GCM},t,r)}async function er(e,t,r){return await f.decrypt({...e,name:y.Mode.AES_GCM},t,r)}async function rr(e,t,r,n){return await f.wrapKey(e,t,r,{...n,name:y.Mode.AES_GCM})}async function tr(e,t,r,n,a,o=!0,c){return await f.unwrapKey(e,t,r,n,{...a,name:y.Mode.AES_GCM},o,c)}var xe={get(e,t){switch(t){case"self":return e;case"wrapKey":return(r,n)=>ar(r,n,e);case"unwrapKey":return(r,n,a,o,c)=>or(r,n,a,e,o,c);case"exportKey":return r=>nr(r,e)}return Reflect.get(e,t)}};var nr=async(e,t)=>f.exportKey(e,t);async function ar(e,t,r){return await f.wrapKey(e,t,r,{name:y.Mode.AES_KW})}async function or(e,t,r,n,a=!0,o){return await f.unwrapKey(e,t,r,n,{name:y.Mode.AES_KW},a,o)}var sr={get(e,t){switch(t){case"self":return e;case"deriveKey":return(r,n,a,o)=>ir(r,e,n,a,o);case"deriveBits":return(r,n)=>cr(r,e,n)}return Reflect.get(e,t)}},we={"SHA-1":13e5,"SHA-256":6e5,"SHA-384":6e5,"SHA-512":21e4},Ke=async(e,t,r)=>{let n=await B.generateKeyMaterial(e,t,v.Variant.PBKDF2,r);return w(sr)(n)},ir=async(e,t,r,n,a)=>{let o=await B.deriveKey({...e,name:v.Variant.PBKDF2,iterations:we[e.hash]},t,r,n,a);switch(r.name){case C.Code.HMAC:return w(ye)(o);case y.Mode.AES_CBC:return w(fe)(o);case y.Mode.AES_CTR:return w(me)(o);case y.Mode.AES_GCM:return w(le)(o);case y.Mode.AES_KW:return w(xe)(o)}throw new Error("Invalid alg")},cr=(e,t,r)=>B.deriveBits({...e,name:v.Variant.PBKDF2,iterations:we[e.hash]},t,r);var Ae=async e=>ie(E.Variant.SHA_256,e);var ve={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6};var V={parse:function(t,r){return pr(t,ve,r)},stringify:function(t,r){return ur(t,ve,r)}};function pr(e,t,r){var n;if(r===void 0&&(r={}),!t.codes){t.codes={};for(var a=0;a<t.chars.length;++a)t.codes[t.chars[a]]=a}if(!r.loose&&e.length*t.bits&7)throw new SyntaxError("Invalid padding");for(var o=e.length;e[o-1]==="=";)if(--o,!r.loose&&!((e.length-o)*t.bits&7))throw new SyntaxError("Invalid padding");for(var c=new((n=r.out)!=null?n:Uint8Array)(o*t.bits/8|0),s=0,i=0,p=0,u=0;u<o;++u){var h=t.codes[e[u]];if(h===void 0)throw new SyntaxError("Invalid character "+e[u]);i=i<<t.bits|h,s+=t.bits,s>=8&&(s-=8,c[p++]=255&i>>s)}if(s>=t.bits||255&i<<8-s)throw new SyntaxError("Unexpected end of data");return c}function ur(e,t,r){r===void 0&&(r={});for(var n=r,a=n.pad,o=a===void 0?!0:a,c=(1<<t.bits)-1,s="",i=0,p=0,u=0;u<e.length;++u)for(p=p<<8|255&e[u],i+=8;i>t.bits;)i-=t.bits,s+=t.chars[c&p>>i];if(i&&(s+=t.chars[c&p<<t.bits-i]),o)for(;s.length*t.bits&7;)s+="=";return s}function j(e){return new TextDecoder().decode(V.parse(e,{loose:!0}))}function O(e){return V.stringify(new TextEncoder().encode(e),{pad:!1})}function Ce(...e){let t=e.reduce((a,o)=>a+o.byteLength,0),r=new Uint8Array(t),n=0;for(let a of e)r.set(new Uint8Array(a),n),n+=a.byteLength;return r.buffer}var he=new TextEncoder,be=new TextDecoder,k=he.encode.bind(he),Se=be.decode.bind(be),$=O,J=j,fr=e=>Uint8Array.from(e,t=>t.charCodeAt(0)).buffer,dr=e=>String.fromCharCode(...new Uint8Array(e)),Q=e=>fr(J(e)),X=e=>$(dr(e));async function Y(e){return await Ae(e)}async function ge({key:e,plaintext:t}){let r=await U.generate(16),n=await e.encrypt({iv:r},t);return{iv:r,ciphertext:n}}async function Ee({key:e,iv:t,ciphertext:r}){return await e.decrypt({iv:t},r)}async function Me(e){let t=await D.generate(16),r=await _(16),n=await Z({salt:t,entropy:r,password:e});return{salt:t,entropy:r,key:n}}async function Z({salt:e,entropy:t,password:r}){return await(await Ke("raw",Ce(t,r))).deriveKey({hash:E.Variant.SHA_256,salt:e},{name:y.Mode.AES_GCM,length:256})}var Be=document.querySelector("section#loader"),R=document.querySelector("aside#error"),m;(i=>(i.section=document.querySelector("section#encrypt"),i.form=i.section.querySelector("form#encrypt-form"),i.formBtn=i.form.querySelector("button"),i.password=i.form.querySelector("input#encrypt-password"),i.secret=i.form.querySelector("textarea#encrypt-secret"),i.aside=i.section.querySelector("aside#encrypt-aside"),i.url=i.aside.querySelector("input#encrypt-url"),i.copy=i.aside.querySelector("button#encrypt-url-btn")))(m||={});var l;(s=>(s.section=document.querySelector("section#decrypt"),s.form=s.section.querySelector("form#decrypt-form"),s.formBtn=s.form.querySelector("button"),s.password=s.section.querySelector("input#decrypt-password"),s.aside=s.section.querySelector("aside#decrypt-aside"),s.secret=s.aside.querySelector("textarea#decrypt-secret"),s.copy=s.aside.querySelector("button#decrypt-secret-btn")))(l||={});function Pe({salt:e,entropy:t,id:r}){let n=JSON.stringify({salt:X(e),entropy:X(t),id:r});return $(n)}function He(){let{salt:e,entropy:t,id:r}=JSON.parse(J(window.location.hash.slice(1)));return{salt:Q(e),entropy:Q(t),id:r}}var q=function(){class e{constructor(){this.cache=new Map;this.counter=0}get(r){if(++this.counter>=30)throw this.clear(),new Error("Too many attempts.");return this.cache.get(r)||null}has(r){return this.cache.has(r)}set(r,n){this.cache.has(r)||this.cache.set(r,n)}clear(){this.cache.clear(),this.counter=0}}return new e}();async function Kr(e){if(z(),e.preventDefault(),l.form.reportValidity()&&window.location.hash)try{l.formBtn.setAttribute("disabled","disabled");let{id:t,salt:r,entropy:n}=He(),a;q.has(t)?a=q.get(t):(a=await T.retrieve({id:t}),q.set(t,a));let{iv:o,ciphertext:c}=a,s=await Y(k(l.password.value.trim())),i=await Z({salt:r,entropy:n,password:s}),p=await Ee({key:i,iv:o,ciphertext:c});l.secret.value=Se(p),l.form.classList.add("hidden"),l.aside.classList.remove("hidden"),history.replaceState("",document.title,window.location.pathname+window.location.search),q.clear()}catch(t){Re(t)}finally{l.formBtn.removeAttribute("disabled")}return!1}async function Ar(e){if(z(),e.preventDefault(),m.form.reportValidity())try{m.formBtn.setAttribute("disabled","disabled");let t=await Y(k(m.password.value.trim())),{key:r,salt:n,entropy:a}=await Me(t),o=k(m.secret.value),c=await ge({key:r,plaintext:o}),{id:s}=await T.store(c),i=Pe({salt:n,entropy:a,id:s});m.url.value=`${location.origin}#${i}`,m.form.classList.add("hidden"),m.aside.classList.remove("hidden")}catch(t){Re(t)}finally{m.formBtn.removeAttribute("disabled")}return!1}var _e=e=>function(r){if(r.target){let n=e.parentNode?.querySelector(".default-message"),a=e.parentNode?.querySelector(".success-message");navigator.clipboard.writeText(e.value).then(()=>{n?.classList.add("hidden"),a?.classList.remove("hidden"),setTimeout(()=>{n?.classList.remove("hidden"),a?.classList.add("hidden")},2e3)})}};function Re(e){let t=R.querySelector("#error-text");t&&(t.textContent=e?.message),R.classList.remove("hidden")}function z(){R.classList.add("hidden")}function vr(){m.form.reset(),l.form.reset(),m.form.addEventListener("submit",Ar),l.form.addEventListener("submit",Kr),m.url.value="",l.secret.value="",window.location.hash?l.section.classList.remove("hidden"):m.section.classList.remove("hidden"),m.copy.addEventListener("click",_e(m.url)),l.copy.addEventListener("click",_e(l.secret)),Be.classList.add("hidden"),R.querySelector("button")?.addEventListener("click",z)}vr();
//# sourceMappingURL=index.js.map
