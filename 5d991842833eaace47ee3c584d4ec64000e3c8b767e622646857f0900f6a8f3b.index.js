var Z=(e,r={})=>fetch(new Request(`https://secrets.api.neal.codes/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})),R;(t=>{async function e(n){let a=await Z("retrieve",n);if(a.ok){let{iv:o,ciphertext:s}=await a.json();return{iv:Uint8Array.from(o).buffer,ciphertext:Uint8Array.from(s).buffer}}let i=await a.json();throw new Error(i?.message)}t.retrieve=e;async function r({ciphertext:n,iv:a}){let i={iv:Array.from(new Uint8Array(a)),ciphertext:Array.from(new Uint8Array(n))},o=await Z("store",i);if(o.ok)return await o.json();let s=await o.json();throw new Error(s?.message)}t.store=r})(R||={});var G=class{static async load(){return typeof crypto<"u"?Promise.resolve(crypto):await(await import("node:crypto")).webcrypto}},d=G.load();async function z(e,r,t){return await(await d).subtle.encrypt(e,r,t)}async function ee(e,r,t){return await(await d).subtle.decrypt(e,r,t)}async function L(e,r,t){return await(await d).subtle.sign(e,r,t)}async function T(e,r,t,n){return await(await d).subtle.verify(e,r,t,n)}async function re(e,r,t,n,a){return await(await d).subtle.deriveKey(e,r,t,n,a)}async function te(e,r,t){if(t%8!==0)throw new RangeError("Length must be a multiple of 8");return await(await d).subtle.deriveBits(e,r,t)}async function ne(e,r,t,n){return await(await d).subtle.wrapKey(e,r,t,n)}async function ae(e,r,t,n,a,i,o){return await(await d).subtle.unwrapKey(e,r,t,n,a,i,o)}async function S(e,r){return e==="jwk"?await(await d).subtle.exportKey(e,r):await(await d).subtle.exportKey(e,r)}async function A(e,r,t,n,a){return e==="jwk"?await(await d).subtle.importKey(e,r,t,n,a):await(await d).subtle.importKey(e,r,t,n,a)}async function g(e,r,t){return await(await d).subtle.generateKey(e,r,t)}async function oe(e,r){return await(await d).subtle.digest(e,r)}var H;(function(e){let r;(function(n){n.ECDSA="ECDSA",n.ECDH="ECDH"})(r=e.Variant||(e.Variant={}));let t;(function(n){n.P_256="P-256",n.P_384="P-384",n.P_521="P-521"})(t=e.Curve||(e.Curve={}))})(H||(H={}));var ie;(function(e){async function r(a,i=!0,o){return await g(a,i,o??l(a.name))}e.generateKey=r;async function t(a,i,o,s=!0,c){return await A(a,i,o,s,c??l(o.name))}e.importKey=t;async function n(a,i){return await S(a,i)}e.exportKey=n})(ie||(ie={}));function w(e){return function(t){return new Proxy(t,e)}}var E;(function(e){let r;(function(t){t.SHA_1="SHA-1",t.SHA_256="SHA-256",t.SHA_384="SHA-384",t.SHA_512="SHA-512"})(r=e.Variant||(e.Variant={}))})(E||(E={}));var I;(function(e){e.hexify=r=>Array.from(new Uint8Array(r)).map(t=>t.toString(16).padStart(2,"0")).join("")})(I||(I={}));var se={get(e,r){switch(r){case"self":return e;case"sign":return t=>Le(e,t);case"verify":return(t,n)=>Te(e,t,n);case"exportKey":return t=>Re(t,e)}return Reflect.get(e,r)}},h;(function(e){let r;(function(t){t.HMAC="HMAC"})(r=e.Code||(e.Code={}))})(h||(h={}));async function Re(e,r){return await S(e,r)}async function Le(e,r){return await L({name:h.Code.HMAC},e,r)}async function Te(e,r,t){return await T({name:h.Code.HMAC},e,r,t)}var v;(function(e){let r;(function(t){t.PBKDF2="PBKDF2",t.HKDF="HKDF"})(r=e.Variant||(e.Variant={}))})(v||(v={}));var B;(function(e){async function r(a,i,o,s=!1){return await A(a,i,o,s,F)}e.generateKeyMaterial=r;async function t(a,i,o,s=!0,c){return await re(a,i,o,s,c??l(o.name))}e.deriveKey=t;async function n(a,i,o){return await te(a,i,o)}e.deriveBits=n})(B||(B={}));var P;(function(e){let r;(function(t){t.RSA_OAEP="RSA-OAEP",t.RSA_PSS="RSA-PSS",t.RSASSA_PKCS1_v1_5="RSASSA-PKCS1-v1_5"})(r=e.Variant||(e.Variant={}))})(P||(P={}));var ce;(function(e){async function r(o,s=!0,c){return await g(o,s,c??l(o.name))}e.generateKey=r;async function t(o,s,c,p=!0,u){return await A(o,s,c,p,u??l(c.name))}e.importKey=t;async function n(o,s){return await S(o,s)}e.exportKey=n;async function a(o,s,c){return await L(o,s,c)}e.sign=a;async function i(o,s,c,p){return await T(o,s,c,p)}e.verify=i})(ce||(ce={}));var ye;(function(e){e.raw="raw",e.pkcs8="pkcs8",e.spki="spki",e.jwk="jwk"})(ye||(ye={}));var K;(function(e){e.encrypt="encrypt",e.decrypt="decrypt",e.sign="sign",e.verify="verify",e.deriveKey="deriveKey",e.deriveBits="deriveBits",e.wrapKey="wrapKey",e.unwrapKey="unwrapKey"})(K||(K={}));var De=[K.encrypt,K.decrypt],Ue=[K.sign,K.verify],Ve=[K.wrapKey,K.unwrapKey],F=[K.deriveKey,K.deriveBits];function l(e){switch(e){case y.Mode.AES_CBC:case y.Mode.AES_CTR:case y.Mode.AES_GCM:case P.Variant.RSA_OAEP:return De;case h.Code.HMAC:case H.Variant.ECDSA:case P.Variant.RSA_PSS:case P.Variant.RSASSA_PKCS1_v1_5:return Ue;case H.Variant.ECDH:case v.Variant.HKDF:case v.Variant.PBKDF2:return F;case y.Mode.AES_KW:return Ve;default:throw new Error(`Invalid alg ${e}`)}}var y;(function(e){let r;(function(t){t.AES_CBC="AES-CBC",t.AES_CTR="AES-CTR",t.AES_GCM="AES-GCM",t.AES_KW="AES-KW"})(r=e.Mode||(e.Mode={}))})(y||(y={}));var f;(function(e){async function r(c,p=!0,u){return await g(c,p,u??l(c.name))}e.generateKey=r;async function t(c,p,u,C=!0,q){return await A(c,p,u,C,q??l(u.name))}e.importKey=t;async function n(c,p){return await S(c,p)}e.exportKey=n;async function a(c,p,u){return await z(c,p,u)}e.encrypt=a;async function i(c,p,u){return await ee(c,p,u)}e.decrypt=i;async function o(c,p,u,C){return await ne(c,p,u,C)}e.wrapKey=o;async function s(c,p,u,C,q,_e=!0,We){return await ae(c,p,C,q,u,_e,We??l(u.name))}e.unwrapKey=s})(f||(f={}));var pe={get(e,r){switch(r){case"self":return e;case"encrypt":return(t,n)=>Ge(t,e,n);case"decrypt":return(t,n)=>Ie(t,e,n);case"wrapKey":return(t,n,a)=>Fe(t,n,e,a);case"unwrapKey":return(t,n,a,i,o,s)=>Ne(t,n,a,e,i,o,s);case"exportKey":return t=>qe(t,e)}return Reflect.get(e,r)}};var qe=async(e,r)=>f.exportKey(e,r);async function Ge(e,r,t){return await f.encrypt({...e,name:y.Mode.AES_CBC},r,t)}async function Ie(e,r,t){return await f.decrypt({...e,name:y.Mode.AES_CBC},r,t)}async function Fe(e,r,t,n){return await f.wrapKey(e,r,t,{...n,name:y.Mode.AES_CBC})}async function Ne(e,r,t,n,a,i=!0,o){return await f.unwrapKey(e,r,t,n,{...a,name:y.Mode.AES_CBC},i,o)}async function _(e){return await(await d).getRandomValues(new Uint8Array(e))}var D;(function(e){async function r(t=16){return await _(t)}e.generate=r})(D||(D={}));var U;(function(e){async function r(t=16){return await _(t)}e.generate=r})(U||(U={}));var ue;(function(e){async function r(){return await(await d).randomUUID()}e.generate=r})(ue||(ue={}));var fe={get(e,r){switch(r){case"self":return e;case"encrypt":return(t,n)=>Oe(t,e,n);case"decrypt":return(t,n)=>$e(t,e,n);case"wrapKey":return(t,n,a)=>Je(t,n,e,a);case"unwrapKey":return(t,n,a,i,o,s)=>Qe(t,n,a,e,i,o,s);case"exportKey":return t=>je(t,e)}return Reflect.get(e,r)}};var je=async(e,r)=>f.exportKey(e,r);async function Oe(e,r,t){return await f.encrypt({...e,name:y.Mode.AES_CTR},r,t)}async function $e(e,r,t){return await f.decrypt({...e,name:y.Mode.AES_CTR},r,t)}async function Je(e,r,t,n){return await f.wrapKey(e,r,t,{...n,name:y.Mode.AES_CTR})}async function Qe(e,r,t,n,a,i=!0,o){return await f.unwrapKey(e,r,t,n,{...a,name:y.Mode.AES_CTR},i,o)}var de={get(e,r){switch(r){case"self":return e;case"encrypt":return(t,n)=>Ye(t,e,n);case"decrypt":return(t,n)=>Ze(t,e,n);case"wrapKey":return(t,n,a)=>ze(t,n,e,a);case"unwrapKey":return(t,n,a,i,o,s)=>er(t,n,a,e,i,o,s);case"exportKey":return t=>Xe(t,e)}return Reflect.get(e,r)}};var Xe=async(e,r)=>f.exportKey(e,r);async function Ye(e,r,t){return await f.encrypt({...e,name:y.Mode.AES_GCM},r,t)}async function Ze(e,r,t){return await f.decrypt({...e,name:y.Mode.AES_GCM},r,t)}async function ze(e,r,t,n){return await f.wrapKey(e,r,t,{...n,name:y.Mode.AES_GCM})}async function er(e,r,t,n,a,i=!0,o){return await f.unwrapKey(e,r,t,n,{...a,name:y.Mode.AES_GCM},i,o)}var me={get(e,r){switch(r){case"self":return e;case"wrapKey":return(t,n)=>tr(t,n,e);case"unwrapKey":return(t,n,a,i,o)=>nr(t,n,a,e,i,o);case"exportKey":return t=>rr(t,e)}return Reflect.get(e,r)}};var rr=async(e,r)=>f.exportKey(e,r);async function tr(e,r,t){return await f.wrapKey(e,r,t,{name:y.Mode.AES_KW})}async function nr(e,r,t,n,a=!0,i){return await f.unwrapKey(e,r,t,n,{name:y.Mode.AES_KW},a,i)}var ar={get(e,r){switch(r){case"self":return e;case"deriveKey":return(t,n,a,i)=>or(t,e,n,a,i);case"deriveBits":return(t,n)=>ir(t,e,n)}return Reflect.get(e,r)}},le={"SHA-256":31e4,"SHA-384":31e4,"SHA-512":12e4},xe=async(e,r,t)=>{let n=await B.generateKeyMaterial(e,r,v.Variant.PBKDF2,t);return w(ar)(n)},or=async(e,r,t,n,a)=>{let i=await B.deriveKey({...e,name:v.Variant.PBKDF2,iterations:le[e.hash]},r,t,n,a);switch(t.name){case h.Code.HMAC:return w(se)(i);case y.Mode.AES_CBC:return w(pe)(i);case y.Mode.AES_CTR:return w(fe)(i);case y.Mode.AES_GCM:return w(de)(i);case y.Mode.AES_KW:return w(me)(i)}throw new Error("Invalid alg")},ir=(e,r,t)=>B.deriveBits({...e,name:v.Variant.PBKDF2,iterations:le[e.hash]},r,t);var we=async e=>oe(E.Variant.SHA_256,e);var Ke={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6};var V={parse:function(r,t){return cr(r,Ke,t)},stringify:function(r,t){return yr(r,Ke,t)}};function cr(e,r,t){var n;if(t===void 0&&(t={}),!r.codes){r.codes={};for(var a=0;a<r.chars.length;++a)r.codes[r.chars[a]]=a}if(!t.loose&&e.length*r.bits&7)throw new SyntaxError("Invalid padding");for(var i=e.length;e[i-1]==="=";)if(--i,!t.loose&&!((e.length-i)*r.bits&7))throw new SyntaxError("Invalid padding");for(var o=new((n=t.out)!=null?n:Uint8Array)(i*r.bits/8|0),s=0,c=0,p=0,u=0;u<i;++u){var C=r.codes[e[u]];if(C===void 0)throw new SyntaxError("Invalid character "+e[u]);c=c<<r.bits|C,s+=r.bits,s>=8&&(s-=8,o[p++]=255&c>>s)}if(s>=r.bits||255&c<<8-s)throw new SyntaxError("Unexpected end of data");return o}function yr(e,r,t){t===void 0&&(t={});for(var n=t,a=n.pad,i=a===void 0?!0:a,o=(1<<r.bits)-1,s="",c=0,p=0,u=0;u<e.length;++u)for(p=p<<8|255&e[u],c+=8;c>r.bits;)c-=r.bits,s+=r.chars[o&p>>c];if(c&&(s+=r.chars[o&p<<r.bits-c]),i)for(;s.length*r.bits&7;)s+="=";return s}function N(e){return new TextDecoder().decode(V.parse(e,{loose:!0}))}function j(e){return V.stringify(new TextEncoder().encode(e),{pad:!1})}function Ce(...e){let r=e.reduce((a,i)=>a+i.byteLength,0),t=new Uint8Array(r),n=0;for(let a of e)t.set(new Uint8Array(a),n),n+=a.byteLength;return t.buffer}var O=j,$=N,Ae=new TextEncoder,ve=new TextDecoder,k=Ae.encode.bind(Ae),Se=ve.decode.bind(ve),pr=e=>Uint8Array.from(e,r=>r.charCodeAt(0)).buffer,ur=e=>String.fromCharCode(...new Uint8Array(e)),J=e=>pr($(e)),Q=e=>O(ur(e));async function X(e){return await we(e)}async function he({key:e,plaintext:r}){let t=await D.generate(16),n=await e.encrypt({iv:t},r);return{iv:t,ciphertext:n}}async function ge({key:e,iv:r,ciphertext:t}){return await e.decrypt({iv:r},t)}async function be(e){let r=await U.generate(16),t=await _(16),n=await Y({salt:r,entropy:t,password:e});return{salt:r,entropy:t,key:n}}async function Y({salt:e,entropy:r,password:t}){return await(await xe("raw",Ce(r,t))).deriveKey({hash:E.Variant.SHA_256,salt:e},{name:y.Mode.AES_GCM,length:256})}var Ee=document.querySelector("section#loader"),W=document.querySelector("aside#error"),m;(s=>(s.section=document.querySelector("section#encrypt"),s.form=s.section.querySelector("form#encrypt-form"),s.password=s.form.querySelector("input#encrypt-password"),s.secret=s.form.querySelector("textarea#encrypt-secret"),s.aside=s.section.querySelector("aside#encrypt-aside"),s.url=s.aside.querySelector("input#encrypt-url"),s.copy=s.aside.querySelector("button#encrypt-url-btn")))(m||={});var x;(o=>(o.section=document.querySelector("section#decrypt"),o.form=o.section.querySelector("form#decrypt-form"),o.password=o.section.querySelector("input#decrypt-password"),o.aside=o.section.querySelector("aside#decrypt-aside"),o.secret=o.aside.querySelector("textarea#decrypt-secret"),o.copy=o.aside.querySelector("button#decrypt-secret-btn")))(x||={});function Me({salt:e,entropy:r,id:t}){let n=JSON.stringify({salt:Q(e),entropy:Q(r),id:t});return O(n)}function Be(){let{salt:e,entropy:r,id:t}=JSON.parse($(window.location.hash.slice(1)));return{salt:J(e),entropy:J(r),id:t}}async function xr(e){if(e.preventDefault(),x.form.reportValidity()&&window.location.hash)try{let{id:r,salt:t,entropy:n}=Be(),{iv:a,ciphertext:i}=await R.retrieve({id:r}),o=await X(k(x.password.value.trim())),s=await Y({salt:t,entropy:n,password:o}),c=await ge({key:s,iv:a,ciphertext:i});x.secret.value=Se(c),x.form.classList.add("hidden"),x.aside.classList.remove("hidden"),history.replaceState("",document.title,window.location.pathname+window.location.search)}catch(r){He(r)}return!1}async function wr(e){if(e.preventDefault(),m.form.reportValidity())try{let r=await X(k(m.password.value.trim())),{key:t,salt:n,entropy:a}=await be(r),i=k(m.secret.value),o=await he({key:t,plaintext:i}),{id:s}=await R.store(o),c=Me({salt:n,entropy:a,id:s});m.url.value=`${location.href}#${c}`,m.form.classList.add("hidden"),m.aside.classList.remove("hidden")}catch(r){He(r)}return!1}var Pe=e=>function(t){if(t.target){let n=e.parentNode?.querySelector(".default-message"),a=e.parentNode?.querySelector(".success-message");navigator.clipboard.writeText(e.value).then(()=>{n?.classList.add("hidden"),a?.classList.remove("hidden"),setTimeout(()=>{n?.classList.remove("hidden"),a?.classList.add("hidden")},2e3)})}};function He(e){let r=W.querySelector("#error-text");r&&(r.textContent=e?.message),W.classList.remove("hidden")}function Kr(){m.form.reset(),x.form.reset(),m.form.addEventListener("submit",wr),x.form.addEventListener("submit",xr),m.url.value="",x.secret.value="",window.location.hash?x.section.classList.remove("hidden"):m.section.classList.remove("hidden"),m.copy.addEventListener("click",Pe(m.url)),x.copy.addEventListener("click",Pe(x.secret)),Ee.classList.add("hidden"),W.querySelector("button")?.addEventListener("click",()=>W.classList.add("hidden"))}Kr();
//# sourceMappingURL=index.js.map
