var Y=(e,t={})=>fetch(new Request(`https://secrets.api.neal.codes/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),W;(r=>{async function e(n){let a=await Y("retrieve",n);if(a.ok){let{iv:i,ciphertext:o}=await a.json();return{iv:Uint8Array.from(i).buffer,ciphertext:Uint8Array.from(o).buffer}}throw new Error("Could not retrieve")}r.retrieve=e;async function t({ciphertext:n,iv:a}){let i={iv:Array.from(new Uint8Array(a)),ciphertext:Array.from(new Uint8Array(n))},o=await Y("store",i);if(o.ok)return await o.json();throw new Error("Could not store")}r.store=t})(W||={});var G=class{static async load(){return typeof crypto<"u"?Promise.resolve(crypto):await(await import("node:crypto")).webcrypto}},d=G.load();async function Z(e,t,r){return await(await d).subtle.encrypt(e,t,r)}async function z(e,t,r){return await(await d).subtle.decrypt(e,t,r)}async function T(e,t,r){return await(await d).subtle.sign(e,t,r)}async function R(e,t,r,n){return await(await d).subtle.verify(e,t,r,n)}async function ee(e,t,r,n,a){return await(await d).subtle.deriveKey(e,t,r,n,a)}async function re(e,t,r){if(r%8!==0)throw new RangeError("Length must be a multiple of 8");return await(await d).subtle.deriveBits(e,t,r)}async function te(e,t,r,n){return await(await d).subtle.wrapKey(e,t,r,n)}async function ne(e,t,r,n,a,i,o){return await(await d).subtle.unwrapKey(e,t,r,n,a,i,o)}async function S(e,t){return e==="jwk"?await(await d).subtle.exportKey(e,t):await(await d).subtle.exportKey(e,t)}async function A(e,t,r,n,a){return e==="jwk"?await(await d).subtle.importKey(e,t,r,n,a):await(await d).subtle.importKey(e,t,r,n,a)}async function g(e,t,r){return await(await d).subtle.generateKey(e,t,r)}async function ae(e,t){return await(await d).subtle.digest(e,t)}var _;(function(e){let t;(function(n){n.ECDSA="ECDSA",n.ECDH="ECDH"})(t=e.Variant||(e.Variant={}));let r;(function(n){n.P_256="P-256",n.P_384="P-384",n.P_521="P-521"})(r=e.Curve||(e.Curve={}))})(_||(_={}));var oe;(function(e){async function t(a,i=!0,o){return await g(a,i,o??l(a.name))}e.generateKey=t;async function r(a,i,o,s=!0,c){return await A(a,i,o,s,c??l(o.name))}e.importKey=r;async function n(a,i){return await S(a,i)}e.exportKey=n})(oe||(oe={}));function w(e){return function(r){return new Proxy(r,e)}}var E;(function(e){let t;(function(r){r.SHA_1="SHA-1",r.SHA_256="SHA-256",r.SHA_384="SHA-384",r.SHA_512="SHA-512"})(t=e.Variant||(e.Variant={}))})(E||(E={}));var q;(function(e){e.hexify=t=>Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("")})(q||(q={}));var ie={get(e,t){switch(t){case"self":return e;case"sign":return r=>We(e,r);case"verify":return(r,n)=>Te(e,r,n);case"exportKey":return r=>He(r,e)}return Reflect.get(e,t)}},h;(function(e){let t;(function(r){r.HMAC="HMAC"})(t=e.Code||(e.Code={}))})(h||(h={}));async function He(e,t){return await S(e,t)}async function We(e,t){return await T({name:h.Code.HMAC},e,t)}async function Te(e,t,r){return await R({name:h.Code.HMAC},e,t,r)}var v;(function(e){let t;(function(r){r.PBKDF2="PBKDF2",r.HKDF="HKDF"})(t=e.Variant||(e.Variant={}))})(v||(v={}));var B;(function(e){async function t(a,i,o,s=!1){return await A(a,i,o,s,I)}e.generateKeyMaterial=t;async function r(a,i,o,s=!0,c){return await ee(a,i,o,s,c??l(o.name))}e.deriveKey=r;async function n(a,i,o){return await re(a,i,o)}e.deriveBits=n})(B||(B={}));var P;(function(e){let t;(function(r){r.RSA_OAEP="RSA-OAEP",r.RSA_PSS="RSA-PSS",r.RSASSA_PKCS1_v1_5="RSASSA-PKCS1-v1_5"})(t=e.Variant||(e.Variant={}))})(P||(P={}));var se;(function(e){async function t(o,s=!0,c){return await g(o,s,c??l(o.name))}e.generateKey=t;async function r(o,s,c,p=!0,u){return await A(o,s,c,p,u??l(c.name))}e.importKey=r;async function n(o,s){return await S(o,s)}e.exportKey=n;async function a(o,s,c){return await T(o,s,c)}e.sign=a;async function i(o,s,c,p){return await R(o,s,c,p)}e.verify=i})(se||(se={}));var ce;(function(e){e.raw="raw",e.pkcs8="pkcs8",e.spki="spki",e.jwk="jwk"})(ce||(ce={}));var K;(function(e){e.encrypt="encrypt",e.decrypt="decrypt",e.sign="sign",e.verify="verify",e.deriveKey="deriveKey",e.deriveBits="deriveBits",e.wrapKey="wrapKey",e.unwrapKey="unwrapKey"})(K||(K={}));var Re=[K.encrypt,K.decrypt],Le=[K.sign,K.verify],De=[K.wrapKey,K.unwrapKey],I=[K.deriveKey,K.deriveBits];function l(e){switch(e){case y.Mode.AES_CBC:case y.Mode.AES_CTR:case y.Mode.AES_GCM:case P.Variant.RSA_OAEP:return Re;case h.Code.HMAC:case _.Variant.ECDSA:case P.Variant.RSA_PSS:case P.Variant.RSASSA_PKCS1_v1_5:return Le;case _.Variant.ECDH:case v.Variant.HKDF:case v.Variant.PBKDF2:return I;case y.Mode.AES_KW:return De;default:throw new Error(`Invalid alg ${e}`)}}var y;(function(e){let t;(function(r){r.AES_CBC="AES-CBC",r.AES_CTR="AES-CTR",r.AES_GCM="AES-GCM",r.AES_KW="AES-KW"})(t=e.Mode||(e.Mode={}))})(y||(y={}));var f;(function(e){async function t(c,p=!0,u){return await g(c,p,u??l(c.name))}e.generateKey=t;async function r(c,p,u,C=!0,k){return await A(c,p,u,C,k??l(u.name))}e.importKey=r;async function n(c,p){return await S(c,p)}e.exportKey=n;async function a(c,p,u){return await Z(c,p,u)}e.encrypt=a;async function i(c,p,u){return await z(c,p,u)}e.decrypt=i;async function o(c,p,u,C){return await te(c,p,u,C)}e.wrapKey=o;async function s(c,p,u,C,k,Pe=!0,_e){return await ne(c,p,C,k,u,Pe,_e??l(u.name))}e.unwrapKey=s})(f||(f={}));var ye={get(e,t){switch(t){case"self":return e;case"encrypt":return(r,n)=>ke(r,e,n);case"decrypt":return(r,n)=>Ge(r,e,n);case"wrapKey":return(r,n,a)=>qe(r,n,e,a);case"unwrapKey":return(r,n,a,i,o,s)=>Ie(r,n,a,e,i,o,s);case"exportKey":return r=>Ve(r,e)}return Reflect.get(e,t)}};var Ve=async(e,t)=>f.exportKey(e,t);async function ke(e,t,r){return await f.encrypt({...e,name:y.Mode.AES_CBC},t,r)}async function Ge(e,t,r){return await f.decrypt({...e,name:y.Mode.AES_CBC},t,r)}async function qe(e,t,r,n){return await f.wrapKey(e,t,r,{...n,name:y.Mode.AES_CBC})}async function Ie(e,t,r,n,a,i=!0,o){return await f.unwrapKey(e,t,r,n,{...a,name:y.Mode.AES_CBC},i,o)}async function H(e){return await(await d).getRandomValues(new Uint8Array(e))}var L;(function(e){async function t(r=16){return await H(r)}e.generate=t})(L||(L={}));var D;(function(e){async function t(r=16){return await H(r)}e.generate=t})(D||(D={}));var pe;(function(e){async function t(){return await(await d).randomUUID()}e.generate=t})(pe||(pe={}));var ue={get(e,t){switch(t){case"self":return e;case"encrypt":return(r,n)=>Oe(r,e,n);case"decrypt":return(r,n)=>je(r,e,n);case"wrapKey":return(r,n,a)=>Ne(r,n,e,a);case"unwrapKey":return(r,n,a,i,o,s)=>$e(r,n,a,e,i,o,s);case"exportKey":return r=>Fe(r,e)}return Reflect.get(e,t)}};var Fe=async(e,t)=>f.exportKey(e,t);async function Oe(e,t,r){return await f.encrypt({...e,name:y.Mode.AES_CTR},t,r)}async function je(e,t,r){return await f.decrypt({...e,name:y.Mode.AES_CTR},t,r)}async function Ne(e,t,r,n){return await f.wrapKey(e,t,r,{...n,name:y.Mode.AES_CTR})}async function $e(e,t,r,n,a,i=!0,o){return await f.unwrapKey(e,t,r,n,{...a,name:y.Mode.AES_CTR},i,o)}var fe={get(e,t){switch(t){case"self":return e;case"encrypt":return(r,n)=>Qe(r,e,n);case"decrypt":return(r,n)=>Xe(r,e,n);case"wrapKey":return(r,n,a)=>Ye(r,n,e,a);case"unwrapKey":return(r,n,a,i,o,s)=>Ze(r,n,a,e,i,o,s);case"exportKey":return r=>Je(r,e)}return Reflect.get(e,t)}};var Je=async(e,t)=>f.exportKey(e,t);async function Qe(e,t,r){return await f.encrypt({...e,name:y.Mode.AES_GCM},t,r)}async function Xe(e,t,r){return await f.decrypt({...e,name:y.Mode.AES_GCM},t,r)}async function Ye(e,t,r,n){return await f.wrapKey(e,t,r,{...n,name:y.Mode.AES_GCM})}async function Ze(e,t,r,n,a,i=!0,o){return await f.unwrapKey(e,t,r,n,{...a,name:y.Mode.AES_GCM},i,o)}var de={get(e,t){switch(t){case"self":return e;case"wrapKey":return(r,n)=>er(r,n,e);case"unwrapKey":return(r,n,a,i,o)=>rr(r,n,a,e,i,o);case"exportKey":return r=>ze(r,e)}return Reflect.get(e,t)}};var ze=async(e,t)=>f.exportKey(e,t);async function er(e,t,r){return await f.wrapKey(e,t,r,{name:y.Mode.AES_KW})}async function rr(e,t,r,n,a=!0,i){return await f.unwrapKey(e,t,r,n,{name:y.Mode.AES_KW},a,i)}var tr={get(e,t){switch(t){case"self":return e;case"deriveKey":return(r,n,a,i)=>nr(r,e,n,a,i);case"deriveBits":return(r,n)=>ar(r,e,n)}return Reflect.get(e,t)}},me={"SHA-256":31e4,"SHA-384":31e4,"SHA-512":12e4},le=async(e,t,r)=>{let n=await B.generateKeyMaterial(e,t,v.Variant.PBKDF2,r);return w(tr)(n)},nr=async(e,t,r,n,a)=>{let i=await B.deriveKey({...e,name:v.Variant.PBKDF2,iterations:me[e.hash]},t,r,n,a);switch(r.name){case h.Code.HMAC:return w(ie)(i);case y.Mode.AES_CBC:return w(ye)(i);case y.Mode.AES_CTR:return w(ue)(i);case y.Mode.AES_GCM:return w(fe)(i);case y.Mode.AES_KW:return w(de)(i)}throw new Error("Invalid alg")},ar=(e,t,r)=>B.deriveBits({...e,name:v.Variant.PBKDF2,iterations:me[e.hash]},t,r);var xe=async e=>ae(E.Variant.SHA_256,e);var we={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6};var U={parse:function(t,r){return ir(t,we,r)},stringify:function(t,r){return sr(t,we,r)}};function ir(e,t,r){var n;if(r===void 0&&(r={}),!t.codes){t.codes={};for(var a=0;a<t.chars.length;++a)t.codes[t.chars[a]]=a}if(!r.loose&&e.length*t.bits&7)throw new SyntaxError("Invalid padding");for(var i=e.length;e[i-1]==="=";)if(--i,!r.loose&&!((e.length-i)*t.bits&7))throw new SyntaxError("Invalid padding");for(var o=new((n=r.out)!=null?n:Uint8Array)(i*t.bits/8|0),s=0,c=0,p=0,u=0;u<i;++u){var C=t.codes[e[u]];if(C===void 0)throw new SyntaxError("Invalid character "+e[u]);c=c<<t.bits|C,s+=t.bits,s>=8&&(s-=8,o[p++]=255&c>>s)}if(s>=t.bits||255&c<<8-s)throw new SyntaxError("Unexpected end of data");return o}function sr(e,t,r){r===void 0&&(r={});for(var n=r,a=n.pad,i=a===void 0?!0:a,o=(1<<t.bits)-1,s="",c=0,p=0,u=0;u<e.length;++u)for(p=p<<8|255&e[u],c+=8;c>t.bits;)c-=t.bits,s+=t.chars[o&p>>c];if(c&&(s+=t.chars[o&p<<t.bits-c]),i)for(;s.length*t.bits&7;)s+="=";return s}function F(e){return new TextDecoder().decode(U.parse(e,{loose:!0}))}function O(e){return U.stringify(new TextEncoder().encode(e),{pad:!1})}function ve(...e){let t=e.reduce((a,i)=>a+i.byteLength,0),r=new Uint8Array(t),n=0;for(let a of e)r.set(new Uint8Array(a),n),n+=a.byteLength;return r.buffer}var j=O,N=F,Ke=new TextEncoder,Ae=new TextDecoder,V=Ke.encode.bind(Ke),Ce=Ae.decode.bind(Ae),cr=e=>Uint8Array.from(e,t=>t.charCodeAt(0)).buffer,yr=e=>String.fromCharCode(...new Uint8Array(e)),$=e=>cr(N(e)),J=e=>j(yr(e));async function Q(e){return await xe(e)}async function Se({key:e,plaintext:t}){let r=await L.generate(16),n=await e.encrypt({iv:r},t);return{iv:r,ciphertext:n}}async function he({key:e,iv:t,ciphertext:r}){return await e.decrypt({iv:t},r)}async function ge(e){let t=await D.generate(16),r=await H(16),n=await X({salt:t,entropy:r,password:e});return{salt:t,entropy:r,key:n}}async function X({salt:e,entropy:t,password:r}){return await(await le("raw",ve(t,r))).deriveKey({hash:E.Variant.SHA_256,salt:e},{name:y.Mode.AES_GCM,length:256})}var be=document.querySelector("section#loader"),m;(s=>(s.section=document.querySelector("section#encrypt"),s.form=s.section.querySelector("form#encrypt-form"),s.password=s.form.querySelector("input#encrypt-password"),s.secret=s.form.querySelector("textarea#encrypt-secret"),s.aside=s.section.querySelector("aside#encrypt-aside"),s.url=s.aside.querySelector("input#encrypt-url"),s.copy=s.aside.querySelector("button#encrypt-url-btn")))(m||={});var x;(o=>(o.section=document.querySelector("section#decrypt"),o.form=o.section.querySelector("form#decrypt-form"),o.password=o.section.querySelector("input#decrypt-password"),o.aside=o.section.querySelector("aside#decrypt-aside"),o.secret=o.aside.querySelector("textarea#decrypt-secret"),o.copy=o.aside.querySelector("button#decrypt-secret-btn")))(x||={});function Ee({salt:e,entropy:t,id:r}){let n=JSON.stringify({salt:J(e),entropy:J(t),id:r});return j(n)}function Me(){let{salt:e,entropy:t,id:r}=JSON.parse(N(window.location.hash.slice(1)));return{salt:$(e),entropy:$(t),id:r}}async function mr(e){if(e.preventDefault(),x.form.reportValidity()&&window.location.hash){let{id:t,salt:r,entropy:n}=Me(),{iv:a,ciphertext:i}=await W.retrieve({id:t}),o=await Q(V(x.password.value.trim())),s=await X({salt:r,entropy:n,password:o}),c=await he({key:s,iv:a,ciphertext:i});x.secret.value=Ce(c),x.form.classList.add("hidden"),x.aside.classList.remove("hidden"),history.replaceState("",document.title,window.location.pathname+window.location.search)}return!1}async function lr(e){if(e.preventDefault(),m.form.reportValidity()){let t=await Q(V(m.password.value.trim())),{key:r,salt:n,entropy:a}=await ge(t),i=V(m.secret.value),o=await Se({key:r,plaintext:i}),{id:s}=await W.store(o),c=Ee({salt:n,entropy:a,id:s});m.url.value=`${location.href}#${c}`,m.form.classList.add("hidden"),m.aside.classList.remove("hidden")}return!1}var Be=e=>function(r){if(r.target){let n=r.target.querySelector(".default-message"),a=r.target.querySelector(".success-message");navigator.clipboard.writeText(e.value).then(()=>{n.classList.add("hidden"),a.classList.remove("hidden"),setTimeout(()=>{n.classList.remove("hidden"),a.classList.add("hidden")},2e3)})}};function xr(){m.form.reset(),x.form.reset(),m.form.addEventListener("submit",lr),x.form.addEventListener("submit",mr),m.url.value="",x.secret.value="",window.location.hash?x.section.classList.remove("hidden"):m.section.classList.remove("hidden"),m.copy.addEventListener("click",Be(m.url)),x.copy.addEventListener("click",Be(x.secret)),be.classList.add("hidden")}xr();
//# sourceMappingURL=index.js.map
